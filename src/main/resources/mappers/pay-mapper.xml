<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="payMapper">

	<resultMap id="payResult" type="PayDto">
		<id column="APPROVAL_NO" property="approvalNo"/>
		<result column="DOCUMENT_NUMBER" property="documentNo"/>
		<result column="DOCUMENT_TYPE" property="documentType"/>
		<result column="DEPARTMENT" property="department"/>
		<result column="PAYMENT_WRITER" property="payWriter"/>
		<result column="PAYMENT_WRITER_NO" property="payWriterNo"/>
		<result column="PAYMENT_STATUS" property="payStatus"/>
		<result column="DOCUMENT_STATUS" property="documentStatus"/>
		<result column="CANCELLATION_CONTENT" property="cancellContent"/>
		<result column="FIRST_APPROVAL" property="firstApproval"/>
		<result column="MIDDLE_APPROVAL" property="middleApproval"/>
		<result column="FINAL_APPROVAL" property="finalApproval"/>
		<result column="FIRST_APPROVAL_DATE" property="firstApproDt"/>
		<result column="MIDDLE_APPROVAL_DATE" property="middleApproDt"/>
		<result column="FINAL_APPROVAL_DATE" property="finalApproDt"/>
		<result column="REGIST_DATE" property="registDt"/>
		<result column="MODIFY_DATE" property="modifyDt"/>
		<result column="STATUS" property="status"/>
		<result column="FIRST_CHECK" property="firstCheck"/>
		<result column="MIDDLE_CHECK" property="middleCheck"/>
		<result column="FINAL_CHECK" property="finalCheck"/>
		<result column="SALES_STATUS" property="salesStatus"/>
		<result column="DRAFT_STATUS" property="draftStatus"/>
		<result column="BUSINESSTRIP_STATUS" property="businessStatus"/>
		<result column="FIRST_SIGN" property="firstSign"/>
		<result column="MIDDLE_SIGN" property="middleSign"/>
		<result column="FINAL_SIGN" property="finalSign"/>
		<result column="TITLE" property="title"/>
		
		<result column="more_date" property="moreDate"/>
		
		<collection resultMap="ExpenditureResult" property="expenditureList" /> 
	</resultMap>
	
	<!-- 매출보고서 -->
	<resultMap id="ExpenditureResult" type="ExpenditureDto">
		<result column="EXPEND_NO" property="expendNo" />
		<result column="TITLE" property="title" />
		<result column="SALES_DIVISION" property="salesDivision" />		
		<result column="MANAGER_NAME" property="manager" />
		<result column="TOTAL_SALES" property="totalSales" />
		<result column="ITEM" property="item" />
		<result column="VOLUMES" property="quantity" />
		<result column="SALES_AMOUNT" property="salesAmount" />
	</resultMap>
	
	
	<!-- 휴직 신청서 -->
	<resultMap id="RetireResult" type="RetireDto">
		<result column="RETIRE_NO" property="retireNo" />
		<result column="TITLE" property="title" />
		<result column="START_PERIOD" property="startPeriod" />
		<result column="LAST_PERIOD" property="lastPeriod" />
		<result column="RETIRE_CONTENT" property="content" />
		<result column="STATUS" property="status" />
	</resultMap>
	
	<!-- 출장보고서 -->
	<resultMap id="BusinessResult" type="BusinessDto">
		<result column="BUSINESS_NO" property="businessNo" />
		<result column="TITLE" property="title" />
		<result column="RECEIVE_DEPARTMENT" property="reDepartment" />
		<result column="CONTENT" property="content" />
		<result column="BUSINESS_DATE" property="businessDt" />
		<result column="ETC_CONTENT" property="etcContent" />
		<result column="STATUS" property="status" />
	</resultMap>
	
	<!-- 지출결의서 -->
	<resultMap id="DraftResult" type="DraftDto">
		<result column="DRAFT_NO" property="businessNo" />
		<result column="TITLE" property="title" />
		<result column="SUM" property="reDepartment" />
		<result column="VAT" property="content" />
		<result column="TOTAL_SUM" property="businessDt" />
		<result column="STATUS" property="etcContent" />
	</resultMap>
	
	<!-- 기안서 -->
	
	
	<resultMap id="MemberDeptResult" type="MemberDeptDto" >
		<id column="USER_NO" property="userNo"/>
		<result column="USER_NAME" property="userName"/>
		<result column="TEAM_CODE" property="teamCode"/>
		<result column="POSITION_CODE" property="positionCode"/>
		<result column="TEAM_NAME" property="teamName"/>
		<result column="POSITION_NAME" property="positionName"/>
		<result column="DEPT_NAME" property="deptName"/>
	</resultMap>
	
	<resultMap id="SignResult" type="SignDto">
		<id column="APPROVAL_NO" property="approvalNo"/>
		<result column="FIRST_SIGN" property="firstSign"/>
		<result column="MIDDLE_SIGN" property="middleSign"/>
		<result column="FINAL_SIGN" property="finalSign"/>
		<result column="FIRST_APPROVAL_DATE" property="firstApDt"/>
		<result column="MIDDLE_APPROVAL_DATE" property="middleApDt"/>
		<result column="FINAL_APPROVAL_DATE" property="finalApDt"/>
	</resultMap>
	
	<!-- 회원정보 조회용 -->
	<select id="loginUserMember" resultType="string">
		select USER_NAME
			from member
			where user_No = #{userNo}
	</select>
	

	<!-- 메인페이지 목록갯수조회용 -->
	<select id="selectListCount" resultType="_int">
		select count(*) count
			from approval A
			WHERE STATUS = 'Y'
			AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
	</select>
	
	
	<!-- 진행중, 승인완료, 반려 처리된 목록리스트 조회 -->
	<select id="paymainPage" resultMap="payResult">
		select 
		      APPROVAL_NO
		    , case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end document_type
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') regist_date
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
		AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
		order
			 by APPROVAL_NO desc
	</select>
	
	<!-- 일주일이상 승인완료가 안된 목록 갯수 -->
	<select id="moreDateCount" resultType="_int">
      SELECT COUNT(*) count
			  FROM APPROVAL A
			 WHERE DOCUMENT_STATUS IN ('I', 'D') 
			   AND STATUS = 'Y'
			    AND (
	          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	      			)
	</select>
	
	<!-- 로그인한 사용자의 결재내역(Y,N,I)의 목록 갯수 -->
	<select id="successListCount" resultType="_int">
		select count(*) count
			from approval A
			WHERE STATUS = 'Y'
		    AND DOCUMENT_STATUS IN ('Y', 'N', 'I')
			   and (
		            FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
		         or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
		         or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
          		)
	</select>
	
	 <!-- 카테고리 검색 갯수 조회용쿼리 -->
	 <select id="searchListCount" resultType="_int">
		 select count(*)
				from approval
				WHERE STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
				AND ${condition} LIKE '%' || #{keyword} || '%'
	 </select>
	 
	 <!-- 카테고리 검색 리스트 조회용쿼리 -->
	  <select id="searchList" resultMap="payResult">
		select 
		      APPROVAL_NO
		    , case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end document_type
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') regist_date
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
		WHERE A.STATUS = 'Y'
		AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
		AND ${condition} LIKE '%' || #{keyword} || '%'
		order
			 by APPROVAL_NO desc
		</select>
		
		<!-- 메인 카테고리(문서) 갯수 조회용 -->
		<select id="slistCount" resultType="_int">
			select count(*) count
			  from approval
			  WHERE STATUS = 'Y'
			  AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			  <choose>
					<when test="conditions == '전체'">
					and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
					</when>
					<otherwise>
						and DOCUMENT_TYPE = #{conditions}
					</otherwise>
				</choose>
			
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
		</select>
		
		<!-- 메인 카테고리(문서) 리스트 조회용 -->
		<select id="categoryList" resultMap="payResult">
			select 
		      APPROVAL_NO
		    , case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end document_type
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') regist_date
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
			AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			<choose>
				<when test="conditions == '전체'">
					and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
				</when>
				<otherwise>
						and DOCUMENT_TYPE = #{conditions}
				</otherwise>
			</choose>
			
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
			order
			     by APPROVAL_NO desc
		</select>
		
		<!-- 매출보고서 상세페이지 -->
   <select id="expendDetail" resultType="map">
		   select
		   				APPROVAL_NO 		    
			      , EXPEND_NO
			      , DEPARTMENT
			      , to_char(A.REGIST_DATE, 'YYYY-MM-DD') REGIST_DATE
			      , PAYMENT_WRITER
			      , PAYMENT_WRITER_NO
			      , PAYMENT_STATUS
			      , FIRST_APPROVAL
			      , MIDDLE_APPROVAL
			      , FINAL_APPROVAL
			      , DOCUMENT_STATUS
			      , CANCELLATION_CONTENT
			      , to_char(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
			      , to_char(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
			      , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
			      , TITLE
			      , SALES_DIVISION
			      , MANAGER_NAME
			      , TOTAL_SALES
			      , REPORT_NO
			      , REPORT_TYPE
			      , ITEM
			      , VOLUMES
			      , SALES_AMOUNT
			      , MODIFY_TYPE
				from approval a
	      left join expenditure_report e on (document_number = expend_no)
			  left join item i on (expend_no = report_no)
				where a.STATUS = 'Y'
				 and DOCUMENT_NUMBER = #{documentNo}
         and APPROVAL_NO = #{approvalNo}
         and REPORT_TYPE = 'M'
         AND DOCUMENT_TYPE = 'M'
         and PAYMENT_WRITER_NO = #{payWriterNo}
         and PAYMENT_WRITER = #{payWriter}
   </select>
   
   <!-- 로그인한(관리자) 사용자의 전체 결재 리스트 갯수 -->
   <select id="allUserCount" resultType="_int">
   		select 
		     	count(*)
				from approval A
				WHERE STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
		        and (FIRST_APPROVAL = #{userName}
		        or MIDDLE_APPROVAL = #{userName}
		        or FINAL_APPROVAL = #{userName})
   </select>
   
   
   
   
   <!-- 로그인한(관리자) 사용자의 전체 결재 리스트 -->
   <select id="allUserList" resultMap="payResult">
   		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
	      and( 
	      		FIRST_APPROVAL = #{userName}
	       or MIDDLE_APPROVAL = #{userName}
	       or FINAL_APPROVAL = #{userName}
	      	 )
				order
					 by APPROVAL_NO desc
				 
   </select>
   
   
    <select id="userSelectListCount" resultType="_int">
	   		select 
			     		count(*)
					from approval A
					WHERE STATUS = 'Y'
					AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			        and (FIRST_APPROVAL = #{userName}
			        or MIDDLE_APPROVAL = #{userName}
			        or FINAL_APPROVAL = #{userName})
		      <choose>
						<when test="conditions == '전체'">
						and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
						</when>
						<otherwise>
							and DOCUMENT_TYPE = #{conditions}
						</otherwise>			
		     	</choose>
					<choose>
						<when test="status == '전체'">
							and PAYMENT_STATUS IN ('보통','긴급')
						</when>
						<otherwise>
							and PAYMENT_STATUS = #{status}
						</otherwise>
					</choose>  
   </select>
   
   
   <!-- 전체수신결재함 conditions, status값이있을때 -->
   <select id="userSelectList" resultMap="payResult">
   		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
				from approval A
		    join member m on( USER_NO =  PAYMENT_WRITER_NO)
				WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
	      and( 
	      		FIRST_APPROVAL = #{userName}
	       or MIDDLE_APPROVAL = #{userName}
	       or FINAL_APPROVAL = #{userName}
	      	 )
	     <choose>
					<when test="conditions == '전체'">
					  and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
					</when>
					<otherwise>
						and DOCUMENT_TYPE = #{conditions}
					</otherwise>			
	     </choose>
	     
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
				order
					 by APPROVAL_NO desc
   </select>
   
   <!-- 각부서의 속한 팀명, 부장, 과장, 차장 이름 리스트 -->
   <select id="selectDepartment" resultMap="MemberDeptResult">
   		select 
		       	 USER_NO
		       , USER_NAME
		       , TEAM_CODE
		       , POSITION_CODE
		       , (SELECT CODE_NAME 
		           FROM TB_GROUP G
		           WHERE CODE = TEAM_CODE
		            AND GROUP_CODE = 'TEAM01' 
		         ) AS "TEAM_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'POSI01' AND CODE = M.POSITION_CODE) AS "POSITION_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'DEPT01' AND CODE = G.UPPER_CODE) AS "DEPT_NAME"
				FROM
				    MEMBER M
				JOIN TB_GROUP G ON M.TEAM_CODE = G.CODE AND G.GROUP_CODE = 'TEAM01'
				WHERE  G.UPPER_CODE IN ('A', 'B', 'C', 'D', 'E', 'F')
				<choose>
					<when test="userName == null">
						AND  POSITION_CODE IN ('C', 'D', 'E')
					</when>
					<when test="userName != null">
						 AND USER_NAME = #{userName}
				  	 AND USER_NO = #{userNo}
					</when>
				</choose>
   </select>

   <insert id="insertMreport">
   	INSERT 
		  INTO 
		    EXPENDITURE_REPORT
		    (
		      EXPEND_NO
				,	SALES_DIVISION
				,	MANAGER_NAME
				,	TOTAL_SALES
		    )
		    VALUES
		    (
		      SEQ_EXNO.NEXTVAL
		    , #{sales}
		    , #{manager}
		    , #{totalSales}
		    )
   </insert>

   <insert id="insertItems">
   	INSERT 
	    INTO 
	    		ITEM
			    (
			      REPORT_NO
			    , REPORT_TYPE 
			    , ITEM
			    , VOLUMES
			    , SALES_AMOUNT  
			    )
			    VALUES
			    (
			      SEQ_EXNO.CURRVAL
			    , 'M'
			    , #{item}
			    , #{count}
			    , #{salesAmount}
			    )
   </insert>
   <insert id="insertApproval">
	   INSERT
		    INTO APPROVAL
		    (
		      APPROVAL_NO
		    , DOCUMENT_NUMBER
		    , DOCUMENT_TYPE
		    , DEPARTMENT
		    , PAYMENT_WRITER
		    , PAYMENT_WRITER_NO
		    , PAYMENT_STATUS
		    , FIRST_APPROVAL
		    , MIDDLE_APPROVAL
		    , FINAL_APPROVAL
		    , REGIST_DATE
		    , TITLE
		    )
		    VALUES
		    (
		      SEQ_APNO.NEXTVAL
			  , SEQ_EXNO.currval
		    , 'M'
		    , #{deptName}
		    , #{writerName}
		    , #{writerNo}
		    , #{status}
		    , #{firstApproval}
		    , #{middleApproval}
		    , #{finalApproval}
		    , #{writerDate}
		    , #{title}
		    )
   </insert>
      
   
   <!-- 반려 사유 update -->
   <insert id="ajaxUpdateReject">
	   	update approval
			   set CANCELLATION_CONTENT = #{content}
			     <choose>
				     	<when test="approvalSignNo == 1">
				     	, FIRST_APPROVAL_DATE = SYSDATE
				     	, FIRST_SIGN = '반려'
				     	, document_status = 'N'
				     	</when>
				     	<when test="approvalSignNo == 2">
				     	, MIDDLE_APPROVAL_DATE = SYSDATE
				     	, MIDDLE_SIGN = '반려'
				     	, document_status = 'N'
				     	</when>
				     	<when test="approvalSignNo == 3">
				     	, FINAL_APPROVAL_DATE = SYSDATE
				     	, FINAL_SIGN = '반려'
				     	, document_status = 'N'
				     	</when>
			     </choose>
			 where approval_no = #{approvalNo}
   </insert>
   
   <select id="userSearchCount" resultType="_int">
	   	select 
		     		count(*)
				from approval A
				WHERE STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
         and (FIRST_APPROVAL = #{userName}
	       or MIDDLE_APPROVAL = #{userName}
	       or FINAL_APPROVAL = #{userName})
		    AND ${condition} LIKE '%' || #{keyword} || '%'
   </select>
   
   <select id="userSearchList" resultMap="payResult">
   		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
				from approval A
				WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
	      and (FIRST_APPROVAL = #{userName}
	       or MIDDLE_APPROVAL = #{userName}
	       or FINAL_APPROVAL = #{userName})
	      AND ${condition} LIKE '%' || #{keyword} || '%'
				order
					 by APPROVAL_NO desc
   </select>
				 	
		<update id="updateMreport">
			update EXPENDITURE_REPORT
			 	 set SALES_DIVISION = #{sales}
			 	   , MANAGER_NAME = #{manager}
			 	   , TOTAL_SALES = #{totalSales}
			 where EXPEND_NO= #{expendNo}
		</update>
		
		<delete id="deleteReport">
			 delete from ITEM
			  where REPORT_NO = #{reportNo} 
			  and REPORT_TYPE = #{reportType}
		</delete>
		
	 <insert id="updateInsertItems">
	   	INSERT 
		    INTO 
		    		ITEM
				    (
				      REPORT_NO
				    , REPORT_TYPE 
				    , ITEM
				    , VOLUMES
				    , SALES_AMOUNT  
				    )
				    VALUES
				    (
				      #{expendNo}
				    , 'M'
				    , #{item}
				    , #{count}
				    , #{salesAmount}
				    )
	   </insert>
	   
	   <update id="updateApproval">
	   		UPDATE APPROVAL
				   SET PAYMENT_STATUS = #{status}
				     , TITLE = #{title}
				     , FIRST_APPROVAL = #{firstApproval}
				     , MIDDLE_APPROVAL = #{middleApproval}
				     , FINAL_APPROVAL = #{finalApproval}
				     , MODIFY_DATE = #{writerDate}
				     , FIRST_SIGN = NULL
				     , MIDDLE_SIGN = NULL
				     , FINAL_SIGN = NULL
				     , FIRST_APPROVAL_DATE = NULL
				     , MIDDLE_APPROVAL_DATE = NULL
				     , FINAL_APPROVAL_DATE = NULL
				     , CANCELLATION_CONTENT = NULL
				     , DOCUMENT_STATUS = 'D'
				     , MODIFY_TYPE = #{modifyType}
				 WHERE APPROVAL_NO = #{approvalNo}
	   </update>
	   
	   <insert id="gReportInsert">
	   insert 
	   			into SALES_REPORT
	   			(
	   			  SALES_NO
					, EFFECTIVE_DATE
					, COOPERATION_DEPARTMENT
					, CONTENT
					, STATUS
	   			)
	   			values
	   			(
	   			  SEQ_SRNO.NEXTVAL
	   			, #{dateStart}
	   			, #{depWith}
	   			, #{content}
	   			, #{fileStatus}
	   			)
	   </insert>
	   
	   <insert id="gReportAttachInsert">
	   		insert 
	   				into ATTACHMENT
	   				(
	   				  FILE_NO
	   				, ORIGIN_NAME
	   				, ATTACH_PATH
	   				, MODIFY_NAME
	   				, REF_TYPE
	   				, REF_NO
	   				)
	   				values
	   				(
	   				  SEQ_ANO.nextval
	   				, #{originalName}
	   				, #{filePath}
	   				, #{filesystemName}
	   				, #{RefType}
	   				, SEQ_SRNO.CURRVAL
	   				)
	   				
	   </insert>
	    
	   <insert id="gReportApprovalInsert">
	   	 insert
	   	      into APPROVAL
	   	      (
	   	        APPROVAL_NO
						,	DOCUMENT_NUMBER
						,	DOCUMENT_TYPE
						,	DEPARTMENT
						,	PAYMENT_WRITER
						,	PAYMENT_WRITER_NO
						,	PAYMENT_STATUS
						,	FIRST_APPROVAL
						,	MIDDLE_APPROVAL
						,	FINAL_APPROVAL
						,	REGIST_DATE
						, TITLE
	   	      )
	   	     values
	   	     (
	   	       SEQ_APNO.NEXTVAL
	   	     , SEQ_SRNO.CURRVAL
	   	     , 'G'
	   	     , #{deptName} 
	   	     , #{writerName}
	   	     , #{writerNo}
	   	     , #{status}
	   	     , #{firstApproval}
	   	     , #{middleApproval}
	   	     , #{finalApproval}
	   	     , #{writerDate}
	   	     , #{title}
	   	     )
	   </insert>
	   
	   
	   <select id="salesDetail" resultType="map">
        select
                APPROVAL_NO
              , DOCUMENT_NUMBER
				      , DEPARTMENT
				      , to_char(REGIST_DATE, 'YYYY-MM-DD') REGIST_DATE
				      , PAYMENT_WRITER
				      , PAYMENT_WRITER_NO
				      , PAYMENT_STATUS
				      , FIRST_APPROVAL
				      , MIDDLE_APPROVAL
				      , FINAL_APPROVAL
				      , DOCUMENT_STATUS
				      , CANCELLATION_CONTENT
				      , to_char(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
				      , to_char(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
				      , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
				      , SALES_NO
				      , to_char(EFFECTIVE_DATE, 'YYYY-MM-DD') EFFECTIVE_DATE
              , COOPERATION_DEPARTMENT
              , TITLE
              , FILE_NO
              , ORIGIN_NAME
              , ENROLL_DATE
              , MODIFY_NAME
              , ATTACH_PATH
              , REF_NO
              , MODIFY_TYPE
          from approval ap
          join SALES_REPORT s on (SALES_NO = DOCUMENT_NUMBER)
          join ATTACHMENT at on (ref_no = SALES_NO)
          where ref_type = 'PG'
          and ap.STATUS = 'Y'
          and REF_NO = #{documentNo}
          and DOCUMENT_NUMBER = #{documentNo}
          and APPROVAL_NO = #{approvalNo}
          and DOCUMENT_TYPE = 'G'
          and PAYMENT_WRITER_NO = #{payWriterNo}
          and PAYMENT_WRITER = #{payWriter}
	   </select>
	   
	   <select id="contentSelect" resultType="string">
	   	select 
	   			   content
	   	  from SALES_REPORT
	   	 where SALES_NO = #{documentNo}
	   </select>
	   
	   
	   <select id="insertBreport">
	   insert 
	   			into 
	   				FIXTURES_REPORT
	   				(
				   	  FIX_NO
						, TOTAL_SUM
						, ETC_CONTENT   				
	   				)
						values
						(
						SEQ_FIXNO.NEXTVAL
						, #{totalSum}
						, #{etcList}
						)
	   </select>
	   
	   <select id="insertItemsB">
	   	insert 
				  into
				    ITEM
				    (
				      REPORT_NO
				    , REPORT_TYPE
				    , PRODUCT_NAME
				    , PRODUCT_SIZE
				    , QUANTITY
				    , UNIT_PRICE
				    , PRICE
				    , NOTE
				    )
				    values
				    (
				      seq_fixno.currval
				    , 'B'
				    , #{pName}
				    , #{size}
				    , #{amount}
				    , #{unitPrice}
				    , #{price}
				    , #{etc}
				     )
	   </select>
	   
	   <insert id="bReportApprovalInsert">
	   INSERT
		    INTO APPROVAL
		    (
		      APPROVAL_NO
		    , DOCUMENT_NUMBER
		    , DOCUMENT_TYPE
		    , DEPARTMENT
		    , PAYMENT_WRITER
		    , PAYMENT_WRITER_NO
		    , PAYMENT_STATUS
		    , FIRST_APPROVAL
		    , MIDDLE_APPROVAL
		    , FINAL_APPROVAL
		    , REGIST_DATE
		    , TITLE
		    )
		    VALUES
		    (
		      SEQ_APNO.NEXTVAL
			  , seq_fixno.currval
		    , 'B'
		    , #{deptName}
		    , #{writerName}
		    , #{writerNo}
		    , #{status}
		    , #{firstApproval}
		    , #{middleApproval}
		    , #{finalApproval}
		    , #{writerDate}
		    , #{title}
		    )
   </insert>
   
   <select id="fixDetail" resultType="map">
			select
				    	APPROVAL_NO
				    , DOCUMENT_NUMBER
				    , DOCUMENT_TYPE
				    , DEPARTMENT
				    , PAYMENT_WRITER
				    , PAYMENT_WRITER_NO
				    , PAYMENT_STATUS
				    , DOCUMENT_STATUS
				    , CANCELLATION_CONTENT
				    , FIRST_APPROVAL
				    , MIDDLE_APPROVAL
				    , FINAL_APPROVAL
			      , to_char(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
			      , to_char(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
			      , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
			      , to_char(REGIST_DATE, 'YYYY-MM-DD') REGIST_DATE
				    , FIX_NO
				    , TITLE
				    , TOTAL_SUM
				    , ETC_CONTENT 
				    , REPORT_NO
				    , REPORT_TYPE
				    , PRODUCT_NAME
				    , PRODUCT_SIZE
				    , QUANTITY
				    , UNIT_PRICE
				    , PRICE
				    , NOTE
				    , MODIFY_TYPE
				from approval a
				left join FIXTURES_REPORT  on ( DOCUMENT_NUMBER = FIX_NO )
				left join item on ( FIX_NO = REPORT_NO )
				 where a.STATUS = 'Y'
					 and DOCUMENT_NUMBER = #{documentNo}
	         and APPROVAL_NO = #{approvalNo}
	         and REPORT_TYPE = 'B'
        	 AND DOCUMENT_TYPE = 'B'
	         and PAYMENT_WRITER_NO = #{payWriterNo}
   </select>
   
   <insert id="hReportInsert">
   		insert 
   					into RETIRE_REPORT
   							(
   							RETIRE_NO
							,	START_PERIOD
							,	LAST_PERIOD
							,	RETIRE_CONTENT
							,	STATUS
   							)
   						VALUES
   						(
   						 SEQ_RETNO.NEXTVAL
   						,#{startDate}
   						,#{endDate}
   						,#{content}
   						,#{distinguish}
   						)	
   </insert>
   
   <insert id="hReportApprovalInsert">
   	   INSERT
			    INTO APPROVAL
			    
			    (
			      APPROVAL_NO
			    , DOCUMENT_NUMBER
			    , DOCUMENT_TYPE
			    , DEPARTMENT
			    , PAYMENT_WRITER
			    , PAYMENT_WRITER_NO
			    , PAYMENT_STATUS
			    , FIRST_APPROVAL
			    , MIDDLE_APPROVAL
			    , FINAL_APPROVAL
			    , REGIST_DATE
			    , TITLE
			    )
			    VALUES
			    (
			      SEQ_APNO.NEXTVAL
				  , SEQ_RETNO.CURRVAL
			    , 'H'
			    , #{deptName}
			    , #{writerName}
			    , #{writerNo}
			    , #{status}
			    , #{firstApproval}
			    , #{middleApproval}
			    , #{finalApproval}
			    , #{writerDate}
			    , #{title}
			    )
   </insert>
   
   <select id="retireDetail" resultType="map">
   			select
				    APPROVAL_NO
				    , DOCUMENT_NUMBER
				    , DOCUMENT_TYPE
				    , DEPARTMENT
				    , PAYMENT_WRITER
				    , PAYMENT_WRITER_NO
				    , PAYMENT_STATUS
				    , DOCUMENT_STATUS
				    , CANCELLATION_CONTENT
				    , FIRST_APPROVAL
				    , MIDDLE_APPROVAL
				    , FINAL_APPROVAL
			      , to_char(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
			      , to_char(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
			      , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
			      , to_char(REGIST_DATE, 'YYYY-MM-DD') REGIST_DATE
			  	  , RETIRE_NO 
			  	  , to_char(START_PERIOD, 'YYYY-MM-DD') START_PERIOD
			  	  , to_char(LAST_PERIOD, 'YYYY-MM-DD') LAST_PERIOD
            , RETIRE_CONTENT
            , r.STATUS
            , TITLE
            , MODIFY_TYPE
				from approval a
				left join RETIRE_REPORT r on ( DOCUMENT_NUMBER = RETIRE_NO )
				 where a.STATUS = 'Y'
					 and DOCUMENT_NUMBER = #{documentNo}
           and APPROVAL_NO = #{approvalNo}
           and DOCUMENT_TYPE = 'H'
           and PAYMENT_WRITER_NO = #{payWriterNo}
           and PAYMENT_WRITER = #{payWriter}
	  </select>
	  
	  <insert id="insertJreport">
	  	insert 
  				into
  					DRAFT_REPORT
  					(
  					 DRAFT_NO
						,	SUM
						,	VAT
						,	TOTAL_SUM
						,	STATUS
  					)
  					VALUES
  					(
  					SEQ_DRNO.NEXTVAL
  					,#{totalPrice}
  					,#{vat}
  					,#{totalExpendPrice}
  					,#{fileStatus}
  					)
	  </insert>
	  
	  <insert id="insertItemsJ">
	  	insert
	  			into 
	  			    ITEM
	  			   (
						   REPORT_NO
						 , REPORT_TYPE
						 , ACCOUNT
						 , CONTENT
						 , AMOUNT
					   )
					   values
					   (
					     SEQ_DRNO.currval
					   , 'J'
					   , #{account}
					   , #{usage}
					   , #{price}
					   )
	  </insert>
	  
	  <insert id="jReportApprovalInsert">
		   insert
		   	      into APPROVAL
		   	      (
		   	        APPROVAL_NO
							,	DOCUMENT_NUMBER
							,	DOCUMENT_TYPE
							,	DEPARTMENT
							,	PAYMENT_WRITER
							,	PAYMENT_WRITER_NO
							,	PAYMENT_STATUS
							,	FIRST_APPROVAL
							,	MIDDLE_APPROVAL
							,	FINAL_APPROVAL
							,	REGIST_DATE
							, TITLE
		   	      )
		   	     values
		   	     (
		   	       SEQ_APNO.NEXTVAL
		   	     , SEQ_DRNO.CURRVAL
		   	     , 'J'
		   	     , #{deptName} 
		   	     , #{writerName}
		   	     , #{writerNo}
		   	     , #{status}
		   	     , #{firstApproval}
		   	     , #{middleApproval}
		   	     , #{finalApproval}
		   	     , #{writerDate}
		   	     , #{title}
		   	     )
	  </insert>
	  
	 <insert id="jReportAttachInsert">
	  	insert 
	   				into ATTACHMENT
	   				(
	   				  FILE_NO
	   				, ORIGIN_NAME
	   				, ATTACH_PATH
	   				, MODIFY_NAME
	   				, REF_TYPE
	   				, REF_NO
	   				)
	   				values
	   				(
	   				  SEQ_ANO.nextval
	   				, #{originalName}
	   				, #{filePath}
	   				, #{filesystemName}
	   				, #{RefType}
	   				, SEQ_DRNO.CURRVAL
	   				)
	  </insert>
	  
	  
	  <insert id="updateInsertItemsJ">
	  	insert
	  			into 
	  			    ITEM
	  			   (
						   REPORT_NO
						 , REPORT_TYPE
						 , ACCOUNT
						 , CONTENT
						 , AMOUNT
					   )
					   values
					   (
					     #{reportNo}
					   , 'J'
					   , #{account}
					   , #{usage}
					   , #{price}
					   )
	  </insert>
	  
	  

	  
	  
	 <select id="draftDetail" resultType="map">
			 SELECT  
						  DRAFT_NO
						, TITLE
						, SUM
						, VAT
						, TOTAL_SUM
						, REPORT_NO
						, REPORT_TYPE
						, ACCOUNT
						, CONTENT
						, AMOUNT
						, APPROVAL_NO
						, DOCUMENT_NUMBER
						, DOCUMENT_TYPE
						, DOCUMENT_STATUS
						, DEPARTMENT
						, PAYMENT_WRITER
						, PAYMENT_WRITER_NO
						, PAYMENT_STATUS
						, FIRST_APPROVAL
						, MIDDLE_APPROVAL
						, FINAL_APPROVAL
						, CANCELLATION_CONTENT
						, to_char(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
			      , to_char(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
			      , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
						, to_char(A.REGIST_DATE, 'YYYY-MM-DD') REGIST_DATE
						, MODIFY_TYPE
				FROM approval A
				JOIN DRAFT_REPORT DR ON (DOCUMENT_NUMBER = DRAFT_NO)
				JOIN ITEM I ON (DRAFT_NO = REPORT_NO)
				WHERE REPORT_TYPE = 'J'
				  AND A.STATUS = 'Y'
				  AND A.DOCUMENT_TYPE = 'J'
				  AND A.APPROVAL_NO = #{approvalNo}
				  AND DR.DRAFT_NO = #{documentNo}
				  AND I.REPORT_NO = #{documentNo}
				  AND DOCUMENT_NUMBER = #{documentNo}
				  AND A.PAYMENT_WRITER_NO = #{payWriterNo}
	 </select>
	 
	 <select id="fileDraftDetail" resultType="map">
	 			select			
	 					  FILE_NO
						, ORIGIN_NAME
						, ATTACH_PATH
						, MODIFY_NAME
						, REF_TYPE
						,	REF_NO
			   from ATTACHMENT
				where REF_NO = #{documentNo}
				  and REF_TYPE = #{refType}
				  AND STATUS = 'Y'
	 </select>
	 
	 <update id="updateJReport">
	 	update DRAFT_REPORT
	 	   set SUM = #{totalPrice}
				 , VAT = #{vat}
				 , TOTAL_SUM = #{totalExpendPrice}
				 , STATUS = #{fileStatus}
	 	  where DRAFT_NO = #{draftNo}
	 </update>
	 
	 <delete id="deleteJItem">
	 	delete from ITEM
		 where REPORT_NO = #{reportNo}
		   and REPORT_TYPE = #{reportType}
	 </delete>
	 
		<delete id="deleteAttachment">
			delete from ATTACHMENT 
		 	 <where>
				<foreach item="item" collection="array"
								open="file_no in(" separator="," close=")" >
							#{item}
				</foreach>
			</where>
		</delete>
		
		<insert id="insertAttachment">
			insert 
	   				into ATTACHMENT
	   				(
	   				  FILE_NO
	   				, ORIGIN_NAME
	   				, ATTACH_PATH
	   				, MODIFY_NAME
	   				, REF_TYPE
	   				, REF_NO
	   				)
	   				values
	   				(
	   				  SEQ_ANO.nextval
	   				, #{originalName}
	   				, #{filePath}
	   				, #{filesystemName}
	   				, #{RefType}
	   				, #{draftNo}
	   				)
		</insert>
		
		<select id="delayDateList" resultMap="payResult">
		
			select 
				      APPROVAL_NO
				    , case when document_type = 'C' then '출장보고서'
				           when document_type = 'H' then '휴직신청서'
				           when document_type = 'T' then '퇴직신청서'
				           when document_type = 'B' then '비품신청서'
				           when document_type = 'J' then '지출결의서'
				           when document_type = 'G' then '기안서'
				           when document_type = 'M' then '매출보고서'
				      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
		  from approval A
      join member m on( USER_NO =  PAYMENT_WRITER_NO)
		  WHERE DOCUMENT_STATUS IN ('I', 'D') 
		   AND A.STATUS = 'Y'
		    AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7  <![CDATA[ <= ]]>  SYSDATE)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7  <![CDATA[ <= ]]>  SYSDATE)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7  <![CDATA[ <= ]]> SYSDATE)
      			)
		order
			 by APPROVAL_NO desc
			
		</select>
		
		<select id="moreDateSelectCount" resultType="_int">
		
			SELECT COUNT(*) count
			  FROM APPROVAL A
			 WHERE DOCUMENT_STATUS IN ('I', 'D')
			   AND STATUS = 'Y'
			    AND (
	          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	      			)
        <choose>
					<when test="conditions == '전체'">
					and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
					</when>
					<otherwise>
						and DOCUMENT_TYPE = #{conditions}
					</otherwise>
				</choose>
			
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
		
		</select>
		
		<select id="delayDateSelectList" resultMap="payResult">
				select 
				      APPROVAL_NO
				    , case when document_type = 'C' then '출장보고서'
				           when document_type = 'H' then '휴직신청서'
				           when document_type = 'T' then '퇴직신청서'
				           when document_type = 'B' then '비품신청서'
				           when document_type = 'J' then '지출결의서'
				           when document_type = 'G' then '기안서'
				           when document_type = 'M' then '매출보고서'
				      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		  from approval A
      join member m on( USER_NO =  PAYMENT_WRITER_NO)
		 WHERE DOCUMENT_STATUS IN ('I', 'D') 
		   AND A.STATUS = 'Y'
		    AND (
	          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	      			)
      <choose>
				<when test="conditions == '전체'">
				and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
				</when>
				<otherwise>
					and DOCUMENT_TYPE = #{conditions}
				</otherwise>
			</choose>
		
			<choose>
				<when test="status == '전체'">
					and PAYMENT_STATUS IN ('보통','긴급')
				</when>
				<otherwise>
					and PAYMENT_STATUS = #{status}
				</otherwise>
			</choose>  		
		order
			 by APPROVAL_NO desc
		</select>
		
		<select id="moreDateSearchCount" resultType="_int">
				SELECT COUNT(*) count
			  FROM APPROVAL A
			 WHERE DOCUMENT_STATUS IN ('I', 'D')
			   AND STATUS = 'Y'
			    AND (
	          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	      			)
          AND ${condition} LIKE '%' || #{keyword} || '%'
		</select>
		
		<select id="delayDateSearchList" resultMap="payResult">
				select 
				      APPROVAL_NO
				    , case when document_type = 'C' then '출장보고서'
				           when document_type = 'H' then '휴직신청서'
				           when document_type = 'T' then '퇴직신청서'
				           when document_type = 'B' then '비품신청서'
				           when document_type = 'J' then '지출결의서'
				           when document_type = 'G' then '기안서'
				           when document_type = 'M' then '매출보고서'
				      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		  from approval A
      join member m on( USER_NO =  PAYMENT_WRITER_NO)
		 WHERE DOCUMENT_STATUS IN ('I', 'D')
		   AND A.STATUS = 'Y'
		    AND (
	          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND REGIST_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND FIRST_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND MIDDLE_APPROVAL_DATE + 7 <![CDATA[ <= ]]> SYSDATE)
	      			)
				 AND ${condition} LIKE '%' || #{keyword} || '%'		
		
		</select>
		
		<update id="updateHreport">
			update RETIRE_REPORT
				 SET START_PERIOD = #{startDate}
					 , LAST_PERIOD = #{endDate}
					 , RETIRE_CONTENT = #{content}
			 WHERE STATUS = 'H'
			   AND RETIRE_NO = #{retireNo}
		</update>
		
		
		
		<update id="updateBReport">
			update FIXTURES_REPORT
				 set 
							TOTAL_SUM = #{totalSum}
						,	ETC_CONTENT = #{etcList}
			  where FIX_NO = #{fixNo}
		</update>
		
		<delete id="deleteBItem">
			delete from ITEM
			 where REPORT_NO = #{reportNo}
			   and REPORT_TYPE = #{reportType}
		</delete>
		
		<insert id="updateInsertItemsB">
				insert 
				  into
				    ITEM
				    (
				      REPORT_NO
				    , REPORT_TYPE
				    , PRODUCT_NAME
				    , PRODUCT_SIZE
				    , QUANTITY
				    , UNIT_PRICE
				    , PRICE
				    , NOTE
				    )
				    values
				    (
				      #{reportNo}
				    , 'B'
				    , #{pName}
				    , #{size}
				    , #{amount}
				    , #{unitPrice}
				    , #{price}
				    , #{etc}
				     )
		</insert>
		
		<update id="ajaxSign">
			update approval
			   set 
			 where approval_no = #{no}
		</update>
		
		
		<select id="teamNameList" resultType="map">
		   select 
			       DISTINCT  TEAM_CODE
			       ,  (SELECT CODE_NAME 
			           FROM TB_GROUP G
			           WHERE CODE = TEAM_CODE
			            AND GROUP_CODE = 'TEAM01' 
			         ) AS "TEAM_NAME"
			       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'DEPT01' AND CODE = G.UPPER_CODE) AS "DEPT_NAME" 
	        FROM
	            MEMBER M
	        JOIN TB_GROUP G ON M.TEAM_CODE = G.CODE AND G.GROUP_CODE = 'TEAM01'
	        WHERE  G.UPPER_CODE IN ('A', 'B', 'C', 'D', 'E', 'F')
		</select>
		
		<select id="ajaxTeamSearch" resultType="map">
			select 
		       	 USER_NO
		       , USER_NAME
		       , TEAM_CODE
		       , POSITION_CODE
		       , (SELECT CODE_NAME 
		           FROM TB_GROUP G
		           WHERE CODE = TEAM_CODE
		            AND GROUP_CODE = 'TEAM01' 
		         ) AS "TEAM_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'POSI01' AND CODE = M.POSITION_CODE) AS "POSITION_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'DEPT01' AND CODE = G.UPPER_CODE) AS "DEPT_NAME"
				FROM
				    MEMBER M
				JOIN TB_GROUP G ON M.TEAM_CODE = G.CODE AND G.GROUP_CODE = 'TEAM01'
				WHERE  G.UPPER_CODE IN ('A', 'B', 'C', 'D', 'E', 'F')
				 AND POSITION_CODE != 'A'
				  and  CODE_NAME = #{name}
		</select>
		
		<select id="ajaxSearchName" resultType="map">
			select 
		       	 USER_NO
		       , USER_NAME
		       , TEAM_CODE
		       , POSITION_CODE
		       , (SELECT CODE_NAME 
		           FROM TB_GROUP G
		           WHERE CODE = TEAM_CODE
		            AND GROUP_CODE = 'TEAM01' 
		         ) AS "TEAM_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'POSI01' AND CODE = M.POSITION_CODE) AS "POSITION_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'DEPT01' AND CODE = G.UPPER_CODE) AS "DEPT_NAME"
				FROM
				    MEMBER M
				JOIN TB_GROUP G ON M.TEAM_CODE = G.CODE AND G.GROUP_CODE = 'TEAM01'
				WHERE G.UPPER_CODE IN ('A', 'B', 'C', 'D', 'E', 'F')
				  AND POSITION_CODE != 'A'
				  and USER_NAME like '%' || #{name} || '%'
		</select>
	  
	  <update id="ajaxSignUpdate">
	  	update APPROVAL
	  	set
	  	   <choose>
						<when test="approvalSignNo == 1">
						    FIRST_APPROVAL_DATE = SYSDATE
							, FIRST_SIGN = #{dataUrl}
							, DOCUMENT_STATUS = 'I'
							, CANCELLATION_CONTENT = null
						</when>
						<when test="approvalSignNo == 2">
							  MIDDLE_APPROVAL_DATE = SYSDATE
							, MIDDLE_SIGN = #{dataUrl}
							, CANCELLATION_CONTENT = null
						</when>
						<otherwise>
						    FINAL_APPROVAL_DATE = SYSDATE
							, FINAL_SIGN = #{dataUrl}
							, CANCELLATION_CONTENT = null
						</otherwise>	   
	  	   </choose>
	  	 where status = 'Y'
	  	   and APPROVAL_NO = #{approvalNo}
	  </update>
	  
	  
	  <select id="ajaxSignSelect" resultMap="SignResult">
	  	select
	  				APPROVAL_NO
					, FIRST_SIGN
					, MIDDLE_SIGN
					, FINAL_SIGN
					, TO_CHAR(FIRST_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FIRST_APPROVAL_DATE
					, TO_CHAR(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') MIDDLE_APPROVAL_DATE
					, TO_CHAR(FINAL_APPROVAL_DATE, 'YYYY-MM-DD HH24:MI') FINAL_APPROVAL_DATE
					, DOCUMENT_STATUS
			  from APPROVAL
			 where APPROVAL_NO = #{approvalNo}
	  </select>
	  
	  
	  <select id="ApprovedList" resultMap="payResult">
		select 
		      APPROVAL_NO
		    , case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end document_type
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') regist_date
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
		WHERE A.STATUS = 'Y'
		AND DOCUMENT_STATUS IN ('Y', 'N', 'I')
			and (FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
        or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
        or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
        )
		order
			 by APPROVAL_NO desc
	</select>
	  
	 
	 <select id="approvalSearchCount" resultType="_int">
	 		select 
		     		 count(*)
				from approval A
			 WHERE STATUS = 'Y'
         AND DOCUMENT_STATUS IN ('Y', 'N', 'I')
				 AND (FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
      					or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
      					or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
     						 )
		     AND ${condition} LIKE '%' || #{keyword} || '%'
	 </select> 
	 
	  <select id="approvalSearchList" resultMap="payResult">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
			   end document_type
			   , DOCUMENT_NUMBER
			   , DEPARTMENT
			   , PAYMENT_WRITER
			   , PAYMENT_WRITER_NO
			   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
			           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
			           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
			           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
			           END) DOCUMENT_STATUS
			   ,(SELECT count(*)
			        FROM SALES_REPORT S
			      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
			        AND A.document_type = 'G'
			        AND S.STATUS = 'Y'
			    )SALES_STATUS
			    , (SELECT count(*)
			        FROM DRAFT_REPORT D
			        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
			         AND A.document_type = 'J'
			         AND D.STATUS = 'Y'
			     ) DRAFT_STATUS
			    , (SELECT count(*)
			        FROM BUSINESSTRIP_REPORT B
			        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
			        AND A.document_type = 'C'
			        AND B.STATUS = 'Y'
			     ) BUSINESSTRIP_STATUS
			     , to_char(regist_date, 'YYYY-MM-DD') regist_date
			     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
			     , PAYMENT_STATUS
			     , TITLE
			from approval A
			WHERE A.STATUS = 'Y'
				 AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
				 AND (FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
      					or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
      					or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
     						 )
		      AND ${condition} LIKE '%' || #{keyword} || '%'
			order
				 by APPROVAL_NO desc
		</select>
		
		<select id="approvalSelectCount" resultType="_int">
			SELECT COUNT(*) count
			  FROM APPROVAL A
			 WHERE DOCUMENT_STATUS IN ('Y', 'N', 'I')
			   AND STATUS = 'Y'
			    and (FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
      					or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
      					or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
     					 )
        <choose>
					<when test="conditions == '전체'">
					and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
					</when>
					<otherwise>
						and DOCUMENT_TYPE = #{conditions}
					</otherwise>
				</choose>
			
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
				
		</select>
		
		<select id="approvalSelectList" resultMap="payResult">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
			   end document_type
			   , DOCUMENT_NUMBER
			   , DEPARTMENT
			   , PAYMENT_WRITER
			   , PAYMENT_WRITER_NO
			   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
			           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
			           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
			           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
			           END) DOCUMENT_STATUS
			   ,(SELECT count(*)
			        FROM SALES_REPORT S
			      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
			        AND A.document_type = 'G'
			        AND S.STATUS = 'Y'
			    )SALES_STATUS
			    , (SELECT count(*)
			        FROM DRAFT_REPORT D
			        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
			         AND A.document_type = 'J'
			         AND D.STATUS = 'Y'
			     ) DRAFT_STATUS
			    , (SELECT count(*)
			        FROM BUSINESSTRIP_REPORT B
			        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
			        AND A.document_type = 'C'
			        AND B.STATUS = 'Y'
			     ) BUSINESSTRIP_STATUS
			     , to_char(regist_date, 'YYYY-MM-DD') regist_date
			     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
			     , PAYMENT_STATUS
			     , TITLE
			from approval A
			WHERE DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			   AND STATUS = 'Y'
			    and (FIRST_APPROVAL = #{userName} and FIRST_APPROVAL_DATE is not null
      					or MIDDLE_APPROVAL = #{userName} and MIDDLE_APPROVAL_DATE is not null
      					or FINAL_APPROVAL = #{userName} and FINAL_APPROVAL_DATE is not null
     					 )
        <choose>
					<when test="conditions == '전체'">
					and DOCUMENT_TYPE IN ('T','C','B','M','J','G','H','V')
					</when>
					<otherwise>
						and DOCUMENT_TYPE = #{conditions}
					</otherwise>
				</choose>
			
				<choose>
					<when test="status == '전체'">
						and PAYMENT_STATUS IN ('보통','긴급')
					</when>
					<otherwise>
						and PAYMENT_STATUS = #{status}
					</otherwise>
				</choose>
			order
				 by APPROVAL_NO desc
		</select>
		
		
		<!-- 내문서함(전체) 목록갯수조회용 -->
	<select id="myAllApCount" resultType="_int">
		select count(*) count
			from approval A
			WHERE STATUS = 'Y'
				and PAYMENT_WRITER_NO = #{userNo}
			<if test='statusType != null and statusType.equals("All")'>
			AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			</if>
			<if test='statusType != null and statusType.equals("D")'>
			AND DOCUMENT_STATUS = 'D'
			</if>
			<if test='statusType != null and statusType.equals("I")'>
			AND DOCUMENT_STATUS = 'I'
			</if>
			<if test='statusType != null and statusType.equals("Y")'>
			AND DOCUMENT_STATUS = 'Y'
			</if>
			<if test='statusType != null and statusType.equals("N")'>
			AND DOCUMENT_STATUS = 'N'
			</if>
	</select>
	
	<!-- 진행중, 승인완료, 반려 처리된 목록리스트 조회 -->
	<select id="myAllApproval" resultType="map">
		select 
		      APPROVAL_NO
		    , case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end DOCUMENT_TYPE
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') REGIST_DATE
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
			and PAYMENT_WRITER_NO = #{userNo}
			<if test='statusType != null and statusType.equals("All")'>
			AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
			</if>
			<if test='statusType != null and statusType.equals("D")'>
			AND DOCUMENT_STATUS = 'D'
			</if>
			<if test='statusType != null and statusType.equals("I")'>
			AND DOCUMENT_STATUS = 'I'
			</if>
			<if test='statusType != null and statusType.equals("Y")'>
			AND DOCUMENT_STATUS = 'Y'
			</if>
			<if test='statusType != null and statusType.equals("N")'>
			AND DOCUMENT_STATUS = 'N'
			</if>
		order
			 by APPROVAL_NO desc
	</select>
	
	<update id="ajaxAppprovaldelete">
			update APPROVAL
				set STATUS = 'N'
			where APPROVAL_NO = #{no}
	</update>
	
	<select id="mySearchApCount" resultType="_int">
			select count(*) count
				from approval A
				WHERE STATUS = 'Y'
					and PAYMENT_WRITER_NO = #{userNo}
				<choose>
        <when test='statusType != null and (statusType.equals("All") or statusType.equals(""))'>
            AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
        </when>
        <when test='statusType != null and statusType.equals("D")'>
            AND DOCUMENT_STATUS = 'D'
        </when>
        <when test='statusType != null and statusType.equals("I")'>
            AND DOCUMENT_STATUS = 'I'
        </when>
        <when test='statusType != null and statusType.equals("Y")'>
            AND DOCUMENT_STATUS = 'Y'
        </when>
        <when test='statusType != null and statusType.equals("N")'>
            AND DOCUMENT_STATUS = 'N'
        </when>
		    </choose>
		    
		    <if test='option != null and option != "" and keyword != null and keyword != ""'>
		        AND ${option} LIKE '%' || #{keyword} || '%'
		    </if>
	</select>
	
	<select id="mySearchApList" resultType="map">
			select 
		      APPROVAL_NO
		    , (case when document_type = 'C' then '출장보고서'
		           when document_type = 'H' then '휴직신청서'
		           when document_type = 'T' then '퇴직신청서'
		           when document_type = 'B' then '비품신청서'
		           when document_type = 'J' then '지출결의서'
		           when document_type = 'G' then '기안서'
		           when document_type = 'M' then '매출보고서'
		      else '휴가신청서'
		   end) DOCUMENT_TYPE
		   , DOCUMENT_NUMBER
		   , DEPARTMENT
		   , PAYMENT_WRITER
		   , PAYMENT_WRITER_NO
		   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
		           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
		           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
		           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
		           END) DOCUMENT_STATUS
		   ,(SELECT count(*)
		        FROM SALES_REPORT S
		      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
		        AND A.document_type = 'G'
		        AND S.STATUS = 'Y'
		    )SALES_STATUS
		    , (SELECT count(*)
		        FROM DRAFT_REPORT D
		        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
		         AND A.document_type = 'J'
		         AND D.STATUS = 'Y'
		     ) DRAFT_STATUS
		    , (SELECT count(*)
		        FROM BUSINESSTRIP_REPORT B
		        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
		        AND A.document_type = 'C'
		        AND B.STATUS = 'Y'
		     ) BUSINESSTRIP_STATUS
		     , to_char(regist_date, 'YYYY-MM-DD') REGIST_DATE
		     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
		     , PAYMENT_STATUS
		     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE 1=1
		  and A.STATUS = 'Y'
			and PAYMENT_WRITER_NO = #{userNo}
			<choose>
        <when test='statusType != null and (statusType.equals("All") or statusType.equals(""))'>
            AND DOCUMENT_STATUS IN ('Y', 'N', 'I', 'D')
        </when>
        <when test='statusType != null and statusType.equals("D")'>
            AND DOCUMENT_STATUS = 'D'
        </when>
        <when test='statusType != null and statusType.equals("I")'>
            AND DOCUMENT_STATUS = 'I'
        </when>
        <when test='statusType != null and statusType.equals("Y")'>
            AND DOCUMENT_STATUS = 'Y'
        </when>
        <when test='statusType != null and statusType.equals("N")'>
            AND DOCUMENT_STATUS = 'N'
        </when>
		  </choose>
		    <if test='option != null and option != "" and keyword != null and keyword != ""'>
		        AND ${option} LIKE '%' || #{keyword} || '%'
		    </if>
		order
			 by APPROVAL_NO desc
	</select>
	
	<select id="noApprovalSignCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
	</select>
	
	<select id="noApprovalkeywordSignCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
				AND (
				    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
				    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
				    OR A.TITLE LIKE '%' || #{keyword} || '%'
				    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
				)
	</select>
	
	<select id="noApprovalSign" resultMap="payResult">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
		 order
			  by APPROVAL_NO desc
	</select>
	
	<select id="noApprovalSignSelectCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
      <if test='conditions != null and status != null and !conditions.equals("") and !status.equals("")'>
          <choose>
              <when test="conditions == '전체'">
                  AND DOCUMENT_TYPE IN ('T', 'C', 'B', 'M', 'J', 'G', 'H', 'V')
              </when>
              <otherwise>
                  AND DOCUMENT_TYPE = #{conditions}
              </otherwise>
          </choose>
          
          <choose>
              <when test="status == '전체'">
                  AND PAYMENT_STATUS IN ('보통', '긴급')
              </when>
              <otherwise>
                  AND PAYMENT_STATUS = #{status}
              </otherwise>
          </choose>
      </if>
	</select>
	
	
	<select id="noApprovalSignSelectList" resultMap="payResult">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
      <if test='conditions != null and status != null and !conditions.equals("") and !status.equals("")'>
          <choose>
              <when test="conditions == '전체'">
                  AND DOCUMENT_TYPE IN ('T', 'C', 'B', 'M', 'J', 'G', 'H', 'V')
              </when>
              <otherwise>
                  AND DOCUMENT_TYPE = #{conditions}
              </otherwise>
          </choose>
          
          <choose>
              <when test="status == '전체'">
                  AND PAYMENT_STATUS IN ('보통', '긴급')
              </when>
              <otherwise>
                  AND PAYMENT_STATUS = #{status}
              </otherwise>
          </choose>
      </if>
				order
					 by APPROVAL_NO desc
	</select>
	
	<select id="noApprovalSignSearchCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
     AND ${condition} LIKE '%' || #{keyword} || '%'
	</select>
	
		<select id="noApprovalSignSearchList" resultMap="payResult">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
      AND ${condition} LIKE '%' || #{keyword} || '%'
				order
					 by APPROVAL_NO desc
	</select>
	
	<select id="myRejectApCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_SIGN LIKE '%반려%')
          OR (MIDDLE_APPROVAL = #{userName} AND MIDDLE_SIGN LIKE '%반려%')
          OR (FINAL_APPROVAL = #{userName} AND FINAL_SIGN LIKE '%반려%')
      )
      <choose>
      <when test="keyword != null and !keyword.equals('')">
				AND (
				    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
				    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
				    OR A.TITLE LIKE '%' || #{keyword} || '%'
				    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
				)
			</when>
			<otherwise></otherwise>
      </choose>
	</select>
	
		<select id="myRejectApList" resultType="map">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_SIGN LIKE '%반려%')
          OR (MIDDLE_APPROVAL = #{userName} AND MIDDLE_SIGN LIKE '%반려%')
          OR (FINAL_APPROVAL = #{userName} AND FINAL_SIGN LIKE '%반려%')
      )
			<choose>
      <when test="keyword != null and !keyword.equals('')">
				AND (
				    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
				    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
				    OR A.TITLE LIKE '%' || #{keyword} || '%'
				    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
				)
			</when>
			<otherwise></otherwise>
      </choose>
      	order
					 by APPROVAL_NO desc
	</select>
	
	<select id="myFinishApCount" resultType="_int">
		 SELECT COUNT(*)
    FROM approval A
    WHERE A.STATUS = 'Y'
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_SIGN not LIKE '%반려%' and FIRST_SIGN is not null)
          OR (MIDDLE_APPROVAL = #{userName} AND MIDDLE_SIGN not LIKE '%반려%' and MIDDLE_SIGN is not null)
          OR (FINAL_APPROVAL = #{userName} AND FINAL_SIGN not LIKE '%반려%' and FINAL_SIGN is not null)
      )
      <if test="keyword != null and !keyword.equals('') ">
       AND (PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
        OR regist_date LIKE '%' || #{keyword} || '%'
        OR TITLE LIKE '%' || #{keyword} || '%'
        OR DEPARTMENT LIKE '%' || #{keyword} || '%'
        )
      </if>
	</select>
	
	<select id="myFinishApList" resultType="map">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
		WHERE A.STATUS = 'Y'
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_SIGN not LIKE '%반려%' and FIRST_SIGN is not null)
          OR (MIDDLE_APPROVAL = #{userName} AND MIDDLE_SIGN not LIKE '%반려%' and MIDDLE_SIGN is not null)
          OR (FINAL_APPROVAL = #{userName} AND FINAL_SIGN not LIKE '%반려%' and FINAL_SIGN is not null)
      		)
     <if test="keyword != null and !keyword.equals('') ">
       AND (PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
        OR regist_date LIKE '%' || #{keyword} || '%'
        OR TITLE LIKE '%' || #{keyword} || '%'
        OR DEPARTMENT LIKE '%' || #{keyword} || '%'
        )
     </if>
				order
					 by APPROVAL_NO desc
	</select>
	
	<select id="noApprovalSignRe" resultType="map">
			select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
		from approval A
    join member m on( USER_NO =  PAYMENT_WRITER_NO)
		WHERE A.STATUS = 'Y'
				AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL)
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL)
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL)
      )
      <choose>
	      <when test="keyword != null and !keyword.equals('')">
					AND (
					    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
					    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
					    OR A.TITLE LIKE '%' || #{keyword} || '%'
					    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
					)
				</when>
				<otherwise></otherwise>
      </choose>
		 order
			  by APPROVAL_NO desc
	</select>


	<insert id="fixInsert">
		insert
				into
					EQUIPMENT
					(
					  EQUIPMENT_NO
					, EQUIPMENT_NAME
					, EQUIPMENT_COUNT
					, REGIST_DATE
					)
					VALUES
					(
					  SEQ_FXNO.NEXTVAL
					, #{fixName}
					, #{fixAmount}
					, SYSDATE
					)
	</insert>
	
	<select id="noApprovalSignCountToday" resultType="_int">
	 SELECT COUNT(*)
     FROM approval A
    WHERE A.STATUS = 'Y'
      AND DOCUMENT_STATUS IN ('I', 'D')
      AND (
          (FIRST_APPROVAL = #{userName} AND FIRST_APPROVAL_DATE IS NULL AND TO_DATE(A.REGIST_DATE, 'YYYY-MM-DD') = TO_DATE(SYSDATE, 'YYYY-MM-DD'))
          OR (FIRST_APPROVAL_DATE IS NOT NULL AND MIDDLE_APPROVAL = #{userName} AND MIDDLE_APPROVAL_DATE IS NULL AND TO_DATE(FIRST_APPROVAL_DATE, 'YYYY-MM-DD') = TO_DATE(SYSDATE, 'YYYY-MM-DD'))
          OR (MIDDLE_APPROVAL_DATE IS NOT NULL AND FINAL_APPROVAL = #{userName} AND FINAL_APPROVAL_DATE IS NULL AND TO_DATE(MIDDLE_APPROVAL_DATE, 'YYYY-MM-DD') = TO_DATE(SYSDATE, 'YYYY-MM-DD'))
      )
	</select>
	
		<select id="fileStatus" resultType="_int">
			select count(*)
			  from ATTACHMENT
			where REF_NO = #{salesNo}
			  and REF_TYPE = 'PG'
		</select>
		
		<insert id="gReportAttachUpdate">
	   		insert 
	   				into ATTACHMENT
	   				(
	   				  FILE_NO
	   				, ORIGIN_NAME
	   				, ATTACH_PATH
	   				, MODIFY_NAME
	   				, REF_TYPE
	   				, REF_NO
	   				)
	   				values
	   				(
	   				  SEQ_ANO.nextval
	   				, #{originalName}
	   				, #{filePath}
	   				, #{filesystemName}
	   				, #{RefType}
	   				, #{salesNo}
	   				)
	   </insert>
	   
	 <update id="updateGReport">
	 	update SALES_REPORT
	 	   set EFFECTIVE_DATE = #{dateStart}
				 , COOPERATION_DEPARTMENT = #{depWith}
				 , CONTENT = #{content}
				 , STATUS = #{fileStatus}
	 	  where SALES_NO = #{salesNo}
	 </update>
	 
	 <update id="ajaxApprovalprocessing">
	 	update approval
		 	 set DOCUMENT_STATUS = #{status}
	 	 where APPROVAL_NO = #{approvalNo}
	 </update>
	 
	  <!-- 각부서의 속한 팀명, 부장, 과장, 차장 이름 리스트 -->
   <select id="laterSearchDept" resultType="map">
   		select 
		       	 USER_NO
		       , USER_NAME
		       , CODE_NAME
		       , TEAM_CODE
		       , POSITION_CODE
		       , (SELECT CODE_NAME 
		           FROM TB_GROUP G
		           WHERE CODE = TEAM_CODE
		            AND GROUP_CODE = 'TEAM01' 
		         ) AS "TEAM_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'POSI01' AND CODE = M.POSITION_CODE) AS "POSITION_NAME"
		       , (SELECT CODE_NAME FROM TB_GROUP WHERE GROUP_CODE = 'DEPT01' AND CODE = G.UPPER_CODE) AS "DEPT_NAME"
				FROM
				    MEMBER M
				JOIN TB_GROUP G ON M.TEAM_CODE = G.CODE AND G.GROUP_CODE = 'TEAM01'
				WHERE  G.UPPER_CODE IN ('A', 'B', 'C', 'D', 'E', 'F')
					AND (
					       USER_NAME LIKE '%' || #{keyword} || '%'
	            OR CODE_NAME LIKE '%' || #{keyword} || '%'
							)
   </select>
   
   <insert id="insertRefNo">
   	 	INSERT
   	 			INTO 
   	 					RECIPIENT_REFERRER
   	 					(
   	 					REFER_NO
   	 				,	DEF_NO
   	 				, APPROVAL_WRITER_NO
   	 				, REF_WRITER_NO
   	 				, REF_WRITER_NAME
   	 					)
   	 					VALUES
   	 					(
   	 					SEQ_RECNO.NEXTVAL
   	 				, SEQ_APNO.CURRVAL
   	 				, #{writerNo}
   	 				, #{refNo}
   	 				, #{refName}
   	 					)
   </insert>

	<select id="myReferrer" resultType="map">
		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
				from approval A
				WHERE A.STATUS = 'Y'
          and APPROVAL_NO in (select DEF_NO
	      							  				from RECIPIENT_REFERRER
                               where REF_WRITER_NO = #{userNo})
				order
					 by APPROVAL_NO desc
   </select>
   
   <select id="refList" resultType="map">
   		select REF_WRITER_NAME
			  from RECIPIENT_REFERRER
			 where DEF_NO = #{approvalNo}
   </select>
   
   <delete id="deleteRefNo">
			 delete from RECIPIENT_REFERRER
			  where DEF_NO = #{approvalNo} 
		</delete>
   
	
	 <insert id="updateInsertRefNo">
   	 	INSERT
   	 			INTO 
   	 					RECIPIENT_REFERRER
   	 					(
   	 					REFER_NO
   	 				,	DEF_NO
   	 				, APPROVAL_WRITER_NO
   	 				, REF_WRITER_NO
   	 				, REF_WRITER_NAME
   	 					)
   	 					VALUES
   	 					(
   	 					SEQ_RECNO.NEXTVAL
   	 				, #{approvalNo}
   	 				, #{writerNo}
   	 				, #{refNo}
   	 				, #{refName}
   	 					)
   </insert>
   
   <select id="myReferrerCount" resultType="_int">
  		 select count(*)
   			from approval A
				WHERE A.STATUS = 'Y'
          and APPROVAL_NO in (select DEF_NO
	      							  				from RECIPIENT_REFERRER
                               where REF_WRITER_NO = #{userNo})           
   </select>
   
   <select id="myReferrerList" resultType="map">
		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
				from approval A
				WHERE A.STATUS = 'Y'
          and APPROVAL_NO in (select DEF_NO
	      							  				from RECIPIENT_REFERRER
                               where REF_WRITER_NO = #{userNo})
				order
					 by APPROVAL_NO desc
   </select>
   
      <select id="ajaxMyReferrerCount" resultType="_int">
  		 select count(*)
   			from approval A
				WHERE A.STATUS = 'Y'
          and APPROVAL_NO in (select DEF_NO
	      							  				from RECIPIENT_REFERRER
                               where REF_WRITER_NO = #{userNo})                   
          AND (
				    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
				    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
				    OR A.TITLE LIKE '%' || #{keyword} || '%'
				    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
					) 
					              
   </select>
	
		<select id="ajaxMyReferrerList" resultType="map">
		select 
			      APPROVAL_NO
			    , case when document_type = 'C' then '출장보고서'
			           when document_type = 'H' then '휴직신청서'
			           when document_type = 'T' then '퇴직신청서'
			           when document_type = 'B' then '비품신청서'
			           when document_type = 'J' then '지출결의서'
			           when document_type = 'G' then '기안서'
			           when document_type = 'M' then '매출보고서'
			      else '휴가신청서'
				   end document_type
				   , DOCUMENT_NUMBER
				   , DEPARTMENT
				   , PAYMENT_WRITER
				   , PAYMENT_WRITER_NO
				   , (CASE WHEN DOCUMENT_STATUS = 'Y' THEN '완료'
				           WHEN DOCUMENT_STATUS = 'I' THEN '진행'
				           WHEN DOCUMENT_STATUS = 'N' THEN '반려'
				           WHEN DOCUMENT_STATUS = 'D' THEN '대기'
				           END) DOCUMENT_STATUS
				   ,(SELECT count(*)
				        FROM SALES_REPORT S
				      WHERE A.DOCUMENT_NUMBER = S.SALES_NO
				        AND A.document_type = 'G'
				        AND S.STATUS = 'Y'
				    )SALES_STATUS
				    , (SELECT count(*)
				        FROM DRAFT_REPORT D
				        WHERE A.DOCUMENT_NUMBER = D.DRAFT_NO
				         AND A.document_type = 'J'
				         AND D.STATUS = 'Y'
				     ) DRAFT_STATUS
				    , (SELECT count(*)
				        FROM BUSINESSTRIP_REPORT B
				        WHERE A.DOCUMENT_NUMBER = B.BUSINESS_NO
				        AND A.document_type = 'C'
				        AND B.STATUS = 'Y'
				     ) BUSINESSTRIP_STATUS
				     , to_char(regist_date, 'YYYY-MM-DD') regist_date
				     , to_char(FINAL_APPROVAL_DATE, 'YYYY-MM-DD') FINAL_APPROVAL_DATE
				     , PAYMENT_STATUS
				     , TITLE
				from approval A
				WHERE A.STATUS = 'Y'
          and APPROVAL_NO in (select DEF_NO
	      							  				from RECIPIENT_REFERRER
                               where REF_WRITER_NO = #{userNo})           
          AND (
				    A.PAYMENT_WRITER LIKE '%' || #{keyword} || '%'
				    OR TO_CHAR(A.REGIST_DATE, 'YYYY-MM-DD') LIKE '%' || #{keyword} || '%'
				    OR A.TITLE LIKE '%' || #{keyword} || '%'
				    OR A.DEPARTMENT LIKE '%' || #{keyword} || '%'
					) 
				order
					 by APPROVAL_NO desc
   </select>
	 
	 
</mapper>
